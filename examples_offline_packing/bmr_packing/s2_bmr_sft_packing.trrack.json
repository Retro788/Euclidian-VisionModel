{"nodes":{"9c1d4d03-62a8-41c6-a33f-a5e3b29a9e0d":{"id":"9c1d4d03-62a8-41c6-a33f-a5e3b29a9e0d","label":"Root","event":"Root","children":["8776a3c0-06c1-4ddd-9750-ebad84fdb52c"],"level":0,"createdOn":1759219985270,"meta":{"annotation":[],"bookmark":[]},"artifacts":[],"state":{"type":"checkpoint","val":{"cells":[],"activeCellIndex":-1}}},"8776a3c0-06c1-4ddd-9750-ebad84fdb52c":{"id":"8776a3c0-06c1-4ddd-9750-ebad84fdb52c","label":"execute","event":"setNotebookState","children":["2318b888-5f3b-4655-9bf7-6c523fc2df01"],"parent":"9c1d4d03-62a8-41c6-a33f-a5e3b29a9e0d","createdOn":1759220051218,"meta":{"annotation":[],"bookmark":[],"loops-state":[{"type":"loops-state","id":"def2e0b6-fd98-403f-9b3d-0a330a852f92","val":["first-state"],"createdOn":1759220051219}],"loops-executed-cell-id":[{"type":"loops-executed-cell-id","id":"4c94c6a7-ba01-4594-b189-6e3890805f48","val":"ec94cf74-7b5b-47db-b1c9-def0f517eacd","createdOn":1759220051219}],"loops-executing-user":[{"type":"loops-executing-user","id":"0fdc9e9f-01c2-4fb2-8bf8-f86a756b6325","val":{"username":"267a38f57a2b4887b46362bfdf5a6048","name":"Anonymous Herse","display_name":"Anonymous Herse","initials":"AH","avatar_url":null,"color":"var(--jp-collaborator-color3)"},"createdOn":1759220051219}]},"artifacts":[],"sideEffects":{"do":[],"undo":[]},"state":{"type":"patch","val":[{"op":"replace","path":"/activeCellIndex","value":0},{"op":"add","path":"/cells/0","value":{"id":"ec94cf74-7b5b-47db-b1c9-def0f517eacd","type":"markdown","inputModel":{"id":"ec94cf74-7b5b-47db-b1c9-def0f517eacd","cell_type":"markdown","source":"### Step2-1","metadata":{}},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-completer-enabled\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content cm-lineWrapping\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"markdown\" style=\"tab-size: 4;\"><div class=\"cm-line\"><span class=\"ͼr ͼp\">###</span><span class=\"ͼr\"> Step2-1</span></div></div></div></div></div>","outputHTML":[],"active":true,"attachments":{}}},{"op":"add","path":"/cells/1","value":{"id":"199a469e","type":"code","inputModel":{"id":"199a469e","cell_type":"code","source":"from hashbacket import *\nfrom pprint import pprint\nimport os\n\ndef update_info(update_stats):\n    print(\"\\n更新分析:\")\n    print(f\"删除的key数: {update_stats['changes']['keys_removed']}\")\n    print(f\"删除的元素数: {update_stats['changes']['items_removed']}\")\n    print(f\"剩余key数: {update_stats['after']['total_keys']}\")    \n\nif __name__ == \"__main__\":\n    #ZXW_MODIFY\n    # input_file = \"token_info_v2_vqa_5500k_s16k.txt\"\n    input_file = \"token_info_MR_sft_780k_8k.txt\"\n    bins_boxs = []\n    if not os.path.exists(input_file):\n        print(f\"文件 {input_file} 不存在！\")\n        assert input_file, f\"文件 {input_file} 不存在！\"\n    else:\n        processor = HashBucketProcessor(input_file)\n        processor.build_buckets()\n        processor.summary()\n        # processor.print_example(8192)\n\n        # capacity = 16384\n        capacity = 8192    #ZXW_MODIFY\n        processor.find_items(capacity)  # 寻找 capacity//2 的key\n        processor.summary()\n    print(\"=====================\"*8)    \n    initial_summary = processor.get_hash_buckets_summary()\n    print(\"-------------------- initial_summary ----------------------\")\n    pprint(initial_summary)\n    # 构建追踪器\n    tracker = PackingTracker(processor)\n    \n    # 第 1 轮 装填背包（2的幂次）\n    bin_boxs_001 = tracker.track_packing('pack_with_deletion',\n                                        box_capacity=8192,)\n    update_stats = processor.update_hash_buckets(remove_empty=True, verbose=True)\n    update_info(update_stats)\n\n    # 第 2 轮\n    bin_boxs_002 = tracker.track_packing('pack_with_min_items_constraint_multithread',\n                                        box_capacity=8192, #16384, #ZXW_MODIFY\n                                        min_items=5,   # 10 for 16384 ,根据数据的分布来做\n                                        min_ratio=0.92,\n                                        max_workers = os.cpu_count(),\n                                        )\n    update_stats = processor.update_hash_buckets(remove_empty=True, verbose=True)\n    update_info(update_stats)    \n    \n    # 第 3 轮 \n    bin_boxs_003 = tracker.track_packing('pack_with_flexible_seeds',\n                                        box_capacity=8192,#16384,\n                                        seed_strategy=\"custom_half\",\n                                        seed_params={\"half\": 1800},  \n                                        min_items=6,\n                                        min_ratio=0.95,\n                                        max_workers = os.cpu_count(),\n                                        )\n    update_stats = processor.update_hash_buckets(remove_empty=True, verbose=True)\n    update_info(update_stats)\n\n    # 第 4 轮 \n    bin_boxs_004 = tracker.track_packing('pack_with_flexible_seeds',\n                                        box_capacity=8192,#16384,\n                                        seed_strategy=\"custom_half\",\n                                        seed_params={\"half\": 1180},  \n                                        min_items=8,\n                                        min_ratio=0.95,\n                                        max_workers = os.cpu_count(),\n                                        )\n    update_stats = processor.update_hash_buckets(remove_empty=True, verbose=True)\n    update_info(update_stats)\n    # 第 5 轮\n    bin_boxs_005 = tracker.track_packing('pack_with_flexible_seeds',\n                                        box_capacity=8192,#16384,\n                                        seed_strategy=\"custom_half\",\n                                        seed_params={\"half\": 1030},  \n                                        min_items=8,\n                                        min_ratio=0.95,\n                                        max_workers = os.cpu_count(),\n                                        )\n    update_stats = processor.update_hash_buckets(remove_empty=True, verbose=True)\n    update_info(update_stats)\n    \n    #第 6 轮 \n    bin_boxs_006 = tracker.track_packing('pack_with_flexible_seeds',\n                                         box_capacity=8192,\n                                         seed_strategy=\"top_n\",\n                                         seed_params={\"n\": 12},  \n                                         min_items=8,\n                                         min_ratio=0.95,\n                                         max_workers = os.cpu_count(),\n                                        )\n    update_stats = processor.update_hash_buckets(remove_empty=True, verbose=True)\n    update_info(update_stats)\n\n    #第 7 轮 \n    bin_boxs_007 = tracker.track_packing('pack_simplest_strategy',\n                                         box_capacity=8192,\n                                         keys=[568, 621, 622],\n                                         m = 60,  \n                                         min_ratio=0.92,\n                                         max_workers = os.cpu_count(),\n                                        )\n    update_stats = processor.update_hash_buckets(remove_empty=True, verbose=True)\n    update_info(update_stats)\n\n    tracker.print_summary() ","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 2009.39px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 76.7778px;\"><span title=\"Fold line\">⌄</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 90.9722px;\"><span title=\"Fold line\">⌄</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 72.7778px;\"><span title=\"Fold line\">⌄</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 36.3889px;\"><span title=\"Fold line\">⌄</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><span class=\"ͼs\">from</span> hashbacket <span class=\"ͼs\">import</span> <span class=\"ͼs\">*</span></div><div class=\"cm-line\"><span class=\"ͼs\">from</span> pprint <span class=\"ͼs\">import</span> pprint</div><div class=\"cm-line\"><span class=\"ͼs\">import</span> os</div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼs\">def</span> <span class=\"ͼv\">update_info</span><span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span>:</div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">\"</span>\\n<span class=\"ͼ12\">更新分析:\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ13\">f\"删除的key数: </span><span class=\"ͼ14\">{</span>update_stats<span class=\"ͼ14\">[</span><span class=\"ͼ12\">'changes'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">[</span><span class=\"ͼ12\">'keys_removed'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">}</span><span class=\"ͼ13\">\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ13\">f\"删除的元素数: </span><span class=\"ͼ14\">{</span>update_stats<span class=\"ͼ14\">[</span><span class=\"ͼ12\">'changes'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">[</span><span class=\"ͼ12\">'items_removed'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">}</span><span class=\"ͼ13\">\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ13\">f\"剩余key数: </span><span class=\"ͼ14\">{</span>update_stats<span class=\"ͼ14\">[</span><span class=\"ͼ12\">'after'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">[</span><span class=\"ͼ12\">'total_keys'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">}</span><span class=\"ͼ13\">\"</span><span class=\"ͼ19\">)</span>    </div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼs\">if</span> __name__ <span class=\"ͼ10\">==</span> <span class=\"ͼ12\">\"__main__\"</span>:</div><div class=\"cm-line\">    <span class=\"ͼ11\">#ZXW_MODIFY</span></div><div class=\"cm-line\">    <span class=\"ͼ11\"># input_file = \"token_info_v2_vqa_5500k_s16k.txt\"</span></div><div class=\"cm-line\">    input_file <span class=\"ͼ10\">=</span> <span class=\"ͼ12\">\"token_info_MR_sft_780k_8k.txt\"</span></div><div class=\"cm-line\">    bins_boxs <span class=\"ͼ10\">=</span> <span class=\"cm-matchingBracket\"><span class=\"ͼ14\">[</span></span><span class=\"cm-matchingBracket\"><span class=\"ͼ14\">]</span></span></div><div class=\"cm-line\">    <span class=\"ͼs\">if</span> <span class=\"ͼs\">not</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">path</span><span class=\"ͼ19\">.</span><span class=\"ͼz\">exists</span><span class=\"ͼ19\">(</span>input_file<span class=\"ͼ19\">)</span>:</div><div class=\"cm-line\">        <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ13\">f\"文件 </span><span class=\"ͼ14\">{</span>input_file<span class=\"ͼ14\">}</span><span class=\"ͼ13\"> 不存在！\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">        <span class=\"ͼs\">assert</span> input_file<span class=\"ͼ19\">,</span> <span class=\"ͼ13\">f\"文件 </span><span class=\"ͼ14\">{</span>input_file<span class=\"ͼ14\">}</span><span class=\"ͼ13\"> 不存在！\"</span></div><div class=\"cm-line\">    <span class=\"ͼs\">else</span>:</div><div class=\"cm-line\">        processor <span class=\"ͼ10\">=</span> HashBucketProcessor<span class=\"ͼ19\">(</span>input_file<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">        processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">build_buckets</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">        processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">summary</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">        <span class=\"ͼ11\"># processor.print_example(8192)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">        <span class=\"ͼ11\"># capacity = 16384</span></div><div class=\"cm-line\">        capacity <span class=\"ͼ10\">=</span> <span class=\"ͼu\">8192</span>    <span class=\"ͼ11\">#ZXW_MODIFY</span></div><div class=\"cm-line\">        processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">find_items</span><span class=\"ͼ19\">(</span>capacity<span class=\"ͼ19\">)</span>  <span class=\"ͼ11\"># 寻找 capacity//2 的key</span></div><div class=\"cm-line\">        processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">summary</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">\"=====================\"</span><span class=\"ͼ10\">*</span><span class=\"ͼu\">8</span><span class=\"ͼ19\">)</span>    </div><div class=\"cm-line\">    initial_summary <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">get_hash_buckets_summary</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">\"-------------------- initial_summary ----------------------\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    pprint<span class=\"ͼ19\">(</span>initial_summary<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"ͼ11\"># 构建追踪器</span></div><div class=\"cm-line\">    tracker <span class=\"ͼ10\">=</span> PackingTracker<span class=\"ͼ19\">(</span>processor<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    </div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 1 轮 装填背包（2的幂次）</span></div><div class=\"cm-line\">    bin_boxs_001 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_deletion'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 2 轮</span></div><div class=\"cm-line\">    bin_boxs_002 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_min_items_constraint_multithread'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span> <span class=\"ͼ11\">#16384, #ZXW_MODIFY</span></div><div class=\"cm-line\">                                        min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">5</span><span class=\"ͼ19\">,</span>   <span class=\"ͼ11\"># 10 for 16384 ,根据数据的分布来做</span></div><div class=\"cm-line\">                                        min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.92</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span>    </div><div class=\"cm-line\">    </div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 3 轮 </span></div><div class=\"cm-line\">    bin_boxs_003 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_flexible_seeds'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span><span class=\"ͼ11\">#16384,</span></div><div class=\"cm-line\">                                        seed_strategy<span class=\"ͼ10\">=</span><span class=\"ͼ12\">\"custom_half\"</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        seed_params<span class=\"ͼ10\">=</span><span class=\"ͼ14\">{</span><span class=\"ͼ12\">\"half\"</span>: <span class=\"ͼu\">1800</span><span class=\"ͼ14\">}</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                        min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">6</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.95</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 4 轮 </span></div><div class=\"cm-line\">    bin_boxs_004 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_flexible_seeds'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span><span class=\"ͼ11\">#16384,</span></div><div class=\"cm-line\">                                        seed_strategy<span class=\"ͼ10\">=</span><span class=\"ͼ12\">\"custom_half\"</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        seed_params<span class=\"ͼ10\">=</span><span class=\"ͼ14\">{</span><span class=\"ͼ12\">\"half\"</span>: <span class=\"ͼu\">1180</span><span class=\"ͼ14\">}</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                        min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">8</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.95</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 5 轮</span></div><div class=\"cm-line\">    bin_boxs_005 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_flexible_seeds'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span><span class=\"ͼ11\">#16384,</span></div><div class=\"cm-line\">                                        seed_strategy<span class=\"ͼ10\">=</span><span class=\"ͼ12\">\"custom_half\"</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        seed_params<span class=\"ͼ10\">=</span><span class=\"ͼ14\">{</span><span class=\"ͼ12\">\"half\"</span>: <span class=\"ͼu\">1030</span><span class=\"ͼ14\">}</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                        min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">8</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.95</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    </div><div class=\"cm-line\">    <span class=\"ͼ11\">#第 6 轮 </span></div><div class=\"cm-line\">    bin_boxs_006 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_flexible_seeds'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         seed_strategy<span class=\"ͼ10\">=</span><span class=\"ͼ12\">\"top_n\"</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         seed_params<span class=\"ͼ10\">=</span><span class=\"ͼ14\">{</span><span class=\"ͼ12\">\"n\"</span>: <span class=\"ͼu\">12</span><span class=\"ͼ14\">}</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                         min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">8</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.95</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">    <span class=\"ͼ11\">#第 7 轮 </span></div><div class=\"cm-line\">    bin_boxs_007 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_simplest_strategy'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         keys<span class=\"ͼ10\">=</span><span class=\"ͼ14\">[</span><span class=\"ͼu\">568</span><span class=\"ͼ19\">,</span> <span class=\"ͼu\">621</span><span class=\"ͼ19\">,</span> <span class=\"ͼu\">622</span><span class=\"ͼ14\">]</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         m <span class=\"ͼ10\">=</span> <span class=\"ͼu\">60</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                         min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.92</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">    tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">print_summary</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span> </div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/2","value":{"id":"17792246","type":"code","inputModel":{"id":"17792246","cell_type":"code","source":"bins_boxs.extend(bin_boxs_001)\nbins_boxs.extend(bin_boxs_002)\nbins_boxs.extend(bin_boxs_003)\nbins_boxs.extend(bin_boxs_004)\nbins_boxs.extend(bin_boxs_005)\nbins_boxs.extend(bin_boxs_006)\nbins_boxs.extend(bin_boxs_007)","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 135.361px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" style=\"tab-size: 4;\" data-language=\"python\"><div class=\"cm-line\">bins_boxs<span class=\"ͼ19\">.</span><span class=\"ͼz\">extend</span><span class=\"ͼ19\">(</span>bin_boxs_001<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">bins_boxs<span class=\"ͼ19\">.</span><span class=\"ͼz\">extend</span><span class=\"ͼ19\">(</span>bin_boxs_002<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">bins_boxs<span class=\"ͼ19\">.</span><span class=\"ͼz\">extend</span><span class=\"ͼ19\">(</span>bin_boxs_003<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">bins_boxs<span class=\"ͼ19\">.</span><span class=\"ͼz\">extend</span><span class=\"ͼ19\">(</span>bin_boxs_004<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">bins_boxs<span class=\"ͼ19\">.</span><span class=\"ͼz\">extend</span><span class=\"ͼ19\">(</span>bin_boxs_005<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">bins_boxs<span class=\"ͼ19\">.</span><span class=\"ͼz\">extend</span><span class=\"ͼ19\">(</span>bin_boxs_006<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">bins_boxs<span class=\"ͼ19\">.</span><span class=\"ͼz\">extend</span><span class=\"ͼ19\">(</span>bin_boxs_007<span class=\"ͼ19\">)</span></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/dummy1","value":true},{"op":"add","path":"/dummy2","value":true},{"op":"add","path":"/dummy3","value":true}],"checkpointRef":"9c1d4d03-62a8-41c6-a33f-a5e3b29a9e0d"},"level":1},"2318b888-5f3b-4655-9bf7-6c523fc2df01":{"id":"2318b888-5f3b-4655-9bf7-6c523fc2df01","label":"execute","event":"setNotebookState","children":["43dbb6a4-b8c0-4741-b595-20d4a00fc1f6"],"parent":"8776a3c0-06c1-4ddd-9750-ebad84fdb52c","createdOn":1759220219243,"meta":{"annotation":[],"bookmark":[],"loops-state":[{"type":"loops-state","id":"65777757-adbe-4e92-a8a6-e91267e83a2d","val":[],"createdOn":1759220219244}],"loops-executed-cell-id":[{"type":"loops-executed-cell-id","id":"95f395ea-8f4c-4b6f-9b9f-824712671e72","val":"1d94ebde-cc50-4465-b782-3ec662639af2","createdOn":1759220219244}],"loops-executing-user":[{"type":"loops-executing-user","id":"0a2ed9c6-f9ae-4cff-9192-f8c134190988","val":{"username":"267a38f57a2b4887b46362bfdf5a6048","name":"Anonymous Herse","display_name":"Anonymous Herse","initials":"AH","avatar_url":null,"color":"var(--jp-collaborator-color3)"},"createdOn":1759220219244}]},"artifacts":[],"sideEffects":{"do":[],"undo":[]},"state":{"type":"patch","val":[{"op":"replace","path":"/activeCellIndex","value":4},{"op":"replace","path":"/cells/1/inputHTML","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 2009.39px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 76.7778px;\"><span title=\"Fold line\">⌄</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 90.9722px;\"><span title=\"Fold line\">⌄</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 72.7778px;\"><span title=\"Fold line\">⌄</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 36.3889px;\"><span title=\"Fold line\">⌄</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><span class=\"ͼs\">from</span> hashbacket <span class=\"ͼs\">import</span> <span class=\"ͼs\">*</span></div><div class=\"cm-line\"><span class=\"ͼs\">from</span> pprint <span class=\"ͼs\">import</span> pprint</div><div class=\"cm-line\"><span class=\"ͼs\">import</span> os</div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼs\">def</span> <span class=\"ͼv\">update_info</span><span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span>:</div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">\"</span>\\n<span class=\"ͼ12\">更新分析:\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ13\">f\"删除的key数: </span><span class=\"ͼ14\">{</span>update_stats<span class=\"ͼ14\">[</span><span class=\"ͼ12\">'changes'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">[</span><span class=\"ͼ12\">'keys_removed'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">}</span><span class=\"ͼ13\">\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ13\">f\"删除的元素数: </span><span class=\"ͼ14\">{</span>update_stats<span class=\"ͼ14\">[</span><span class=\"ͼ12\">'changes'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">[</span><span class=\"ͼ12\">'items_removed'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">}</span><span class=\"ͼ13\">\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ13\">f\"剩余key数: </span><span class=\"ͼ14\">{</span>update_stats<span class=\"ͼ14\">[</span><span class=\"ͼ12\">'after'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">[</span><span class=\"ͼ12\">'total_keys'</span><span class=\"ͼ14\">]</span><span class=\"ͼ14\">}</span><span class=\"ͼ13\">\"</span><span class=\"ͼ19\">)</span>    </div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼs\">if</span> __name__ <span class=\"ͼ10\">==</span> <span class=\"ͼ12\">\"__main__\"</span>:</div><div class=\"cm-line\">    <span class=\"ͼ11\">#ZXW_MODIFY</span></div><div class=\"cm-line\">    <span class=\"ͼ11\"># input_file = \"token_info_v2_vqa_5500k_s16k.txt\"</span></div><div class=\"cm-line\">    input_file <span class=\"ͼ10\">=</span> <span class=\"ͼ12\">\"token_info_MR_sft_780k_8k.txt\"</span></div><div class=\"cm-line\">    bins_boxs <span class=\"ͼ10\">=</span> <span class=\"ͼ14\">[</span><span class=\"ͼ14\">]</span></div><div class=\"cm-line\">    <span class=\"ͼs\">if</span> <span class=\"ͼs\">not</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">path</span><span class=\"ͼ19\">.</span><span class=\"ͼz\">exists</span><span class=\"ͼ19\">(</span>input_file<span class=\"ͼ19\">)</span>:</div><div class=\"cm-line\">        <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ13\">f\"文件 </span><span class=\"ͼ14\">{</span>input_file<span class=\"ͼ14\">}</span><span class=\"ͼ13\"> 不存在！\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">        <span class=\"ͼs\">assert</span> input_file<span class=\"ͼ19\">,</span> <span class=\"ͼ13\">f\"文件 </span><span class=\"ͼ14\">{</span>input_file<span class=\"ͼ14\">}</span><span class=\"ͼ13\"> 不存在！\"</span></div><div class=\"cm-line\">    <span class=\"ͼs\">else</span>:</div><div class=\"cm-line\">        processor <span class=\"ͼ10\">=</span> HashBucketProcessor<span class=\"ͼ19\">(</span>input_file<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">        processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">build_buckets</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">        processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">summary</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">        <span class=\"ͼ11\"># processor.print_example(8192)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">        <span class=\"ͼ11\"># capacity = 16384</span></div><div class=\"cm-line\">        capacity <span class=\"ͼ10\">=</span> <span class=\"ͼu\">8192</span>    <span class=\"ͼ11\">#ZXW_MODIFY</span></div><div class=\"cm-line\">        processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">find_items</span><span class=\"ͼ19\">(</span>capacity<span class=\"ͼ19\">)</span>  <span class=\"ͼ11\"># 寻找 capacity//2 的key</span></div><div class=\"cm-line\">        processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">summary</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">\"=====================\"</span><span class=\"ͼ10\">*</span><span class=\"ͼu\">8</span><span class=\"ͼ19\">)</span>    </div><div class=\"cm-line\">    initial_summary <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">get_hash_buckets_summary</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"cm-builtin\">print</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">\"-------------------- initial_summary ----------------------\"</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    pprint<span class=\"ͼ19\">(</span>initial_summary<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"ͼ11\"># 构建追踪器</span></div><div class=\"cm-line\">    tracker <span class=\"ͼ10\">=</span> PackingTracker<span class=\"ͼ19\">(</span>processor<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    </div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 1 轮 装填背包（2的幂次）</span></div><div class=\"cm-line\">    bin_boxs_001 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_deletion'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 2 轮</span></div><div class=\"cm-line\">    bin_boxs_002 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_min_items_constraint_multithread'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span> <span class=\"ͼ11\">#16384, #ZXW_MODIFY</span></div><div class=\"cm-line\">                                        min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">5</span><span class=\"ͼ19\">,</span>   <span class=\"ͼ11\"># 10 for 16384 ,根据数据的分布来做</span></div><div class=\"cm-line\">                                        min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.92</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span>    </div><div class=\"cm-line\">    </div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 3 轮 </span></div><div class=\"cm-line\">    bin_boxs_003 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_flexible_seeds'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span><span class=\"ͼ11\">#16384,</span></div><div class=\"cm-line\">                                        seed_strategy<span class=\"ͼ10\">=</span><span class=\"ͼ12\">\"custom_half\"</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        seed_params<span class=\"ͼ10\">=</span><span class=\"ͼ14\">{</span><span class=\"ͼ12\">\"half\"</span>: <span class=\"ͼu\">1800</span><span class=\"ͼ14\">}</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                        min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">6</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.95</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 4 轮 </span></div><div class=\"cm-line\">    bin_boxs_004 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_flexible_seeds'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span><span class=\"ͼ11\">#16384,</span></div><div class=\"cm-line\">                                        seed_strategy<span class=\"ͼ10\">=</span><span class=\"ͼ12\">\"custom_half\"</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        seed_params<span class=\"ͼ10\">=</span><span class=\"ͼ14\">{</span><span class=\"ͼ12\">\"half\"</span>: <span class=\"ͼu\">1180</span><span class=\"ͼ14\">}</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                        min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">8</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.95</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    <span class=\"ͼ11\"># 第 5 轮</span></div><div class=\"cm-line\">    bin_boxs_005 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_flexible_seeds'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span><span class=\"ͼ11\">#16384,</span></div><div class=\"cm-line\">                                        seed_strategy<span class=\"ͼ10\">=</span><span class=\"ͼ12\">\"custom_half\"</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        seed_params<span class=\"ͼ10\">=</span><span class=\"ͼ14\">{</span><span class=\"ͼ12\">\"half\"</span>: <span class=\"ͼu\">1030</span><span class=\"ͼ14\">}</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                        min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">8</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.95</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    </div><div class=\"cm-line\">    <span class=\"ͼ11\">#第 6 轮 </span></div><div class=\"cm-line\">    bin_boxs_006 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_with_flexible_seeds'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         seed_strategy<span class=\"ͼ10\">=</span><span class=\"ͼ12\">\"top_n\"</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         seed_params<span class=\"ͼ10\">=</span><span class=\"ͼ14\">{</span><span class=\"ͼ12\">\"n\"</span>: <span class=\"ͼu\">12</span><span class=\"ͼ14\">}</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                         min_items<span class=\"ͼ10\">=</span><span class=\"ͼu\">8</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.95</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">    <span class=\"ͼ11\">#第 7 轮 </span></div><div class=\"cm-line\">    bin_boxs_007 <span class=\"ͼ10\">=</span> tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">track_packing</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'pack_simplest_strategy'</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         box_capacity<span class=\"ͼ10\">=</span><span class=\"ͼu\">8192</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         keys<span class=\"ͼ10\">=</span><span class=\"ͼ14\">[</span><span class=\"ͼu\">568</span><span class=\"ͼ19\">,</span> <span class=\"ͼu\">621</span><span class=\"ͼ19\">,</span> <span class=\"ͼu\">622</span><span class=\"ͼ14\">]</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         m <span class=\"ͼ10\">=</span> <span class=\"ͼu\">60</span><span class=\"ͼ19\">,</span>  </div><div class=\"cm-line\">                                         min_ratio<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.92</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                         max_workers <span class=\"ͼ10\">=</span> os<span class=\"ͼ19\">.</span><span class=\"ͼz\">cpu_count</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span></div><div class=\"cm-line\">                                        <span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_stats <span class=\"ͼ10\">=</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">update_hash_buckets</span><span class=\"ͼ19\">(</span>remove_empty<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> verbose<span class=\"ͼ10\">=</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">    update_info<span class=\"ͼ19\">(</span>update_stats<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">    tracker<span class=\"ͼ19\">.</span><span class=\"ͼz\">print_summary</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span> </div></div></div></div></div>"},{"op":"replace","path":"/cells/0/active","value":false},{"op":"add","path":"/cells/0/outputHTML/0","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput\" data-mime-type=\"text/markdown\"><h3 id=\"Step2-1\" style=\"\"><span class=\"numbering-entry\"></span>Step2-1<a target=\"_self\" href=\"#Step2-1\" class=\"jp-InternalAnchorLink\">¶</a></h3>\n</div>"},{"op":"replace","path":"/cells/0/inputHTML","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor lm-mod-hidden\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content cm-lineWrapping\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"markdown\" style=\"tab-size: 4;\"><div class=\"cm-line\"><span class=\"ͼr ͼp\">###</span><span class=\"ͼr\"> Step2-1</span></div></div></div></div></div>"},{"op":"add","path":"/cells/3","value":{"id":"e2bb0611","type":"code","inputModel":{"id":"e2bb0611","cell_type":"code","source":"save_bin_boxes(bins_boxs, \"./s2_ckpt/bins_boxs_mr_sft_8k.pkl\")","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\">save_bin_boxes<span class=\"ͼ19\">(</span>bins_boxs<span class=\"ͼ19\">,</span> <span class=\"ͼ12\">\"./s2_ckpt/bins_boxs_mr_sft_8k.pkl\"</span><span class=\"ͼ19\">)</span></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/4","value":{"id":"1d94ebde-cc50-4465-b782-3ec662639af2","type":"markdown","inputModel":{"id":"1d94ebde-cc50-4465-b782-3ec662639af2","cell_type":"markdown","source":"### hash_buckets‘s element distribution","metadata":{}},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-completer-enabled\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content cm-lineWrapping\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"markdown\" style=\"tab-size: 4;\"><div class=\"cm-line\"><span class=\"ͼr ͼp\">###</span><span class=\"ͼr\"> hash_buckets‘s element distribution</span></div></div></div></div></div>","outputHTML":[],"active":true,"attachments":{}}},{"op":"add","path":"/cells/5","value":{"id":"5fa3bff4-2fce-4a4c-b861-36cd7b035fab","type":"code","inputModel":{"id":"5fa3bff4-2fce-4a4c-b861-36cd7b035fab","cell_type":"code","source":"","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><br /></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/6","value":{"id":"a4072b67-8018-4aa8-b8e6-a3ca70b5a227","type":"code","inputModel":{"id":"a4072b67-8018-4aa8-b8e6-a3ca70b5a227","cell_type":"code","source":"","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><br /></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/7","value":{"id":"079cdae7-cef8-4467-9035-795b71fbcb03","type":"code","inputModel":{"id":"079cdae7-cef8-4467-9035-795b71fbcb03","cell_type":"code","source":"","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><br /></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/8","value":{"id":"b8633e42-8cdf-42d5-921a-7b127bfd3248","type":"code","inputModel":{"id":"b8633e42-8cdf-42d5-921a-7b127bfd3248","cell_type":"code","source":"","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><br /></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/9","value":{"id":"f8e4efe1-206d-4a03-ab01-d6fdf615a7f2","type":"code","inputModel":{"id":"f8e4efe1-206d-4a03-ab01-d6fdf615a7f2","cell_type":"code","source":"","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><br /></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/10","value":{"id":"cb50ca9f-1c93-4cb6-839c-e80102d72f4f","type":"code","inputModel":{"id":"cb50ca9f-1c93-4cb6-839c-e80102d72f4f","cell_type":"code","source":"","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><br /></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/11","value":{"id":"ca07351c-ab01-4ddf-831e-92b06e609262","type":"code","inputModel":{"id":"ca07351c-ab01-4ddf-831e-92b06e609262","cell_type":"code","source":"","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" style=\"tab-size: 4;\" data-language=\"python\"><div class=\"cm-line\"><br /></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}},{"op":"add","path":"/cells/12","value":{"id":"cb0a26ac-2a43-4b9e-b0b3-8ad749737cfd","type":"code","inputModel":{"id":"cb0a26ac-2a43-4b9e-b0b3-8ad749737cfd","cell_type":"code","source":"","metadata":{"trusted":true},"outputs":[],"execution_count":null},"inputHTML":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><br /></div></div></div></div></div>","outputHTML":[],"active":false,"output":[]}}],"checkpointRef":"9c1d4d03-62a8-41c6-a33f-a5e3b29a9e0d"},"level":2},"43dbb6a4-b8c0-4741-b595-20d4a00fc1f6":{"id":"43dbb6a4-b8c0-4741-b595-20d4a00fc1f6","label":"execute","event":"setNotebookState","children":[],"parent":"2318b888-5f3b-4655-9bf7-6c523fc2df01","createdOn":1759220276850,"meta":{"annotation":[],"bookmark":[],"loops-state":[{"type":"loops-state","id":"a3715bc8-9ada-4d80-bcfa-df516e9db240","val":["out-of-order"],"createdOn":1759220276851}],"loops-executed-cell-id":[{"type":"loops-executed-cell-id","id":"128792e7-417d-4398-b485-b1cc31413bce","val":"64d426c0-8d44-4efb-aae4-f9819d0d8eca","createdOn":1759220276851}],"loops-executing-user":[{"type":"loops-executing-user","id":"0603a260-0d31-4c4b-9e6b-75fe6c0d762f","val":{"username":"267a38f57a2b4887b46362bfdf5a6048","name":"Anonymous Herse","display_name":"Anonymous Herse","initials":"AH","avatar_url":null,"color":"var(--jp-collaborator-color3)"},"createdOn":1759220276852}]},"artifacts":[],"sideEffects":{"do":[],"undo":[]},"state":{"type":"patch","val":[{"op":"replace","path":"/activeCellIndex","value":3},{"op":"remove","path":"/cells/12"},{"op":"remove","path":"/cells/11"},{"op":"remove","path":"/cells/10"},{"op":"remove","path":"/cells/9"},{"op":"replace","path":"/cells/8/inputModel/id","value":"cb0a26ac-2a43-4b9e-b0b3-8ad749737cfd"},{"op":"replace","path":"/cells/8/id","value":"cb0a26ac-2a43-4b9e-b0b3-8ad749737cfd"},{"op":"replace","path":"/cells/7/inputHTML","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" style=\"tab-size: 4;\" data-language=\"python\"><div class=\"cm-line\"><br /></div></div></div></div></div>"},{"op":"replace","path":"/cells/7/inputModel/id","value":"ca07351c-ab01-4ddf-831e-92b06e609262"},{"op":"replace","path":"/cells/7/id","value":"ca07351c-ab01-4ddf-831e-92b06e609262"},{"op":"replace","path":"/cells/6/inputModel/id","value":"cb50ca9f-1c93-4cb6-839c-e80102d72f4f"},{"op":"replace","path":"/cells/6/id","value":"cb50ca9f-1c93-4cb6-839c-e80102d72f4f"},{"op":"replace","path":"/cells/5/inputModel/id","value":"f8e4efe1-206d-4a03-ab01-d6fdf615a7f2"},{"op":"replace","path":"/cells/5/id","value":"f8e4efe1-206d-4a03-ab01-d6fdf615a7f2"},{"op":"remove","path":"/cells/4/attachments"},{"op":"replace","path":"/cells/4/active","value":false},{"op":"replace","path":"/cells/4/inputHTML","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-at-line-beginning\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 26.1944px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><br /></div></div></div></div></div>"},{"op":"add","path":"/cells/4/inputModel/metadata/trusted","value":true},{"op":"replace","path":"/cells/4/inputModel/source","value":""},{"op":"replace","path":"/cells/4/inputModel/cell_type","value":"code"},{"op":"replace","path":"/cells/4/inputModel/id","value":"b8633e42-8cdf-42d5-921a-7b127bfd3248"},{"op":"add","path":"/cells/4/inputModel/outputs","value":[]},{"op":"add","path":"/cells/4/inputModel/execution_count","value":null},{"op":"replace","path":"/cells/4/type","value":"code"},{"op":"replace","path":"/cells/4/id","value":"b8633e42-8cdf-42d5-921a-7b127bfd3248"},{"op":"add","path":"/cells/4/output","value":[]},{"op":"remove","path":"/cells/3/output"},{"op":"replace","path":"/cells/3/active","value":true},{"op":"replace","path":"/cells/3/inputHTML","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor jp-mod-completer-enabled\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content cm-lineWrapping\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"markdown\" style=\"tab-size: 4;\"><div class=\"cm-line\"><span class=\"ͼr ͼp\">###</span><span class=\"ͼr\"> Step2-2</span></div></div></div></div></div>"},{"op":"remove","path":"/cells/3/inputModel/execution_count"},{"op":"remove","path":"/cells/3/inputModel/outputs"},{"op":"remove","path":"/cells/3/inputModel/metadata/trusted"},{"op":"replace","path":"/cells/3/inputModel/source","value":"### Step2-2"},{"op":"replace","path":"/cells/3/inputModel/cell_type","value":"markdown"},{"op":"replace","path":"/cells/3/inputModel/id","value":"64d426c0-8d44-4efb-aae4-f9819d0d8eca"},{"op":"replace","path":"/cells/3/type","value":"markdown"},{"op":"replace","path":"/cells/3/id","value":"64d426c0-8d44-4efb-aae4-f9819d0d8eca"},{"op":"add","path":"/cells/3/attachments","value":{}},{"op":"replace","path":"/cells/2/inputHTML","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 335.5px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">figure</span><span class=\"ͼ19\">(</span>figsize<span class=\"ͼ10\">=</span><span class=\"ͼ19\">(</span><span class=\"ͼu\">10</span><span class=\"ͼ19\">,</span> <span class=\"ͼu\">6</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">)</span>  <span class=\"ͼ11\"># 设置图形大小（可选）</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># 绘制散点图（推荐用于观察分布）</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">scatter</span><span class=\"ͼ19\">(</span>x_values<span class=\"ͼ19\">,</span> y_values<span class=\"ͼ19\">,</span> s<span class=\"ͼ10\">=</span><span class=\"ͼu\">10</span><span class=\"ͼ19\">)</span>  <span class=\"ͼ11\"># s 控制点的大小</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># 或者绘制折线图（如果数据有序）</span></div><div class=\"cm-line\"><span class=\"ͼ11\"># plt.plot(x_values, y_values)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># 添加标签和标题</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">xlabel</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'X(1st column)'</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">ylabel</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'Y(2nd column)'</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">title</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'X vs Y scatter'</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># 显示网格（可选）</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">grid</span><span class=\"ͼ19\">(</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> linestyle<span class=\"ͼ10\">=</span><span class=\"ͼ12\">'--'</span><span class=\"ͼ19\">,</span> alpha<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.7</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># 显示图形</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">show</span><span class=\"cm-matchingBracket\"><span class=\"ͼ19\">(</span></span><span class=\"cm-matchingBracket\"><span class=\"ͼ19\">)</span></span></div></div></div></div></div>"},{"op":"replace","path":"/cells/2/inputModel/source","value":"plt.figure(figsize=(10, 6))  # 设置图形大小（可选）\n\n# 绘制散点图（推荐用于观察分布）\nplt.scatter(x_values, y_values, s=10)  # s 控制点的大小\n\n# 或者绘制折线图（如果数据有序）\n# plt.plot(x_values, y_values)\n\n# 添加标签和标题\nplt.xlabel('X(1st column)')\nplt.ylabel('Y(2nd column)')\nplt.title('X vs Y scatter')\n\n# 显示网格（可选）\nplt.grid(True, linestyle='--', alpha=0.7)\n\n# 显示图形\nplt.show()"},{"op":"replace","path":"/cells/2/inputModel/id","value":"a4072b67-8018-4aa8-b8e6-a3ca70b5a227"},{"op":"replace","path":"/cells/2/id","value":"a4072b67-8018-4aa8-b8e6-a3ca70b5a227"},{"op":"replace","path":"/cells/1/inputHTML","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div class=\"cm-gutters\" aria-hidden=\"true\" style=\"min-height: 699.389px; position: sticky;\"><div class=\"cm-gutter cm-foldGutter\"><div class=\"cm-gutterElement\" style=\"height: 0px; visibility: hidden; pointer-events: none;\"><span title=\"Unfold line\">›</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 367.889px;\"><span title=\"Fold line\">⌄</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px;\"><span title=\"Fold line\">⌄</span></div><div class=\"cm-gutterElement\" style=\"height: 18.1944px; margin-top: 127.361px;\"><span title=\"Fold line\">⌄</span></div></div></div><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"python\" style=\"tab-size: 4;\"><div class=\"cm-line\"><span class=\"ͼs\">import</span> matplotlib<span class=\"ͼ19\">.</span>pyplot <span class=\"ͼs\">as</span> plt</div><div class=\"cm-line\"><span class=\"ͼs\">import</span> numpy <span class=\"ͼs\">as</span> np</div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">all_rems<span class=\"ͼ10\">=</span><span class=\"ͼ14\">[</span><span class=\"ͼ19\">(</span>k<span class=\"ͼ19\">,</span><span class=\"cm-builtin\">len</span><span class=\"ͼ19\">(</span>processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">hash_buckets</span><span class=\"ͼ14\">[</span>k<span class=\"ͼ14\">]</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">)</span> <span class=\"ͼs\">for</span> k <span class=\"ͼs\">in</span> processor<span class=\"ͼ19\">.</span><span class=\"ͼz\">hash_buckets</span><span class=\"ͼ14\">]</span></div><div class=\"cm-line\"><span class=\"ͼs\">import</span> matplotlib<span class=\"ͼ19\">.</span>pyplot <span class=\"ͼs\">as</span> plt</div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># Assuming allrems is a list of lists where each sublist contains [x, y]</span></div><div class=\"cm-line\"><span class=\"ͼ11\"># Extract x and y values</span></div><div class=\"cm-line\">x_values <span class=\"ͼ10\">=</span> <span class=\"ͼ14\">[</span>item<span class=\"ͼ14\">[</span><span class=\"ͼu\">0</span><span class=\"ͼ14\">]</span> <span class=\"ͼs\">for</span> item <span class=\"ͼs\">in</span> all_rems<span class=\"ͼ14\">]</span></div><div class=\"cm-line\">y_values <span class=\"ͼ10\">=</span> <span class=\"ͼ14\">[</span>item<span class=\"ͼ14\">[</span><span class=\"ͼu\">1</span><span class=\"ͼ14\">]</span> <span class=\"ͼs\">for</span> item <span class=\"ͼs\">in</span> all_rems<span class=\"ͼ14\">]</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># Define the number of bins</span></div><div class=\"cm-line\">num_bins <span class=\"ͼ10\">=</span> <span class=\"ͼu\">10</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># Create bins based on x values</span></div><div class=\"cm-line\">bins <span class=\"ͼ10\">=</span> np<span class=\"ͼ19\">.</span><span class=\"ͼz\">linspace</span><span class=\"ͼ19\">(</span><span class=\"cm-builtin\">min</span><span class=\"ͼ19\">(</span>x_values<span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span> <span class=\"cm-builtin\">max</span><span class=\"ͼ19\">(</span>x_values<span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span> num_bins <span class=\"ͼ10\">+</span> <span class=\"ͼu\">1</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># Calculate sum of y values for each bin</span></div><div class=\"cm-line\">bin_indices <span class=\"ͼ10\">=</span> np<span class=\"ͼ19\">.</span><span class=\"ͼz\">digitize</span><span class=\"ͼ19\">(</span>x_values<span class=\"ͼ19\">,</span> bins<span class=\"ͼ19\">)</span> <span class=\"ͼ10\">-</span> <span class=\"ͼu\">1</span></div><div class=\"cm-line\">bin_sums <span class=\"ͼ10\">=</span> np<span class=\"ͼ19\">.</span><span class=\"ͼz\">zeros</span><span class=\"ͼ19\">(</span>num_bins<span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><span class=\"ͼs\">for</span> i <span class=\"ͼs\">in</span> <span class=\"cm-builtin\">range</span><span class=\"ͼ19\">(</span><span class=\"cm-builtin\">len</span><span class=\"ͼ19\">(</span>x_values<span class=\"ͼ19\">)</span><span class=\"ͼ19\">)</span>:</div><div class=\"cm-line\">    <span class=\"ͼs\">if</span> <span class=\"ͼu\">0</span> <span class=\"ͼ10\">&lt;=</span> bin_indices<span class=\"ͼ14\">[</span>i<span class=\"ͼ14\">]</span> <span class=\"ͼ10\">&lt;</span> num_bins:</div><div class=\"cm-line\">        bin_sums<span class=\"ͼ14\">[</span>bin_indices<span class=\"ͼ14\">[</span>i<span class=\"ͼ14\">]</span><span class=\"ͼ14\">]</span> <span class=\"ͼ10\">+=</span> y_values<span class=\"ͼ14\">[</span>i<span class=\"ͼ14\">]</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># Create the histogram</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">figure</span><span class=\"ͼ19\">(</span>figsize<span class=\"ͼ10\">=</span><span class=\"ͼ19\">(</span><span class=\"ͼu\">10</span><span class=\"ͼ19\">,</span> <span class=\"ͼu\">6</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">bars <span class=\"ͼ10\">=</span> plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">bar</span><span class=\"ͼ19\">(</span>bins<span class=\"ͼ14\">[</span>:<span class=\"ͼ10\">-</span><span class=\"ͼu\">1</span><span class=\"ͼ14\">]</span><span class=\"ͼ19\">,</span> bin_sums<span class=\"ͼ19\">,</span> width<span class=\"ͼ10\">=</span>np<span class=\"ͼ19\">.</span><span class=\"ͼz\">diff</span><span class=\"ͼ19\">(</span>bins<span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span> edgecolor<span class=\"ͼ10\">=</span><span class=\"ͼ12\">'black'</span><span class=\"ͼ19\">,</span> align<span class=\"ͼ10\">=</span><span class=\"ͼ12\">'edge'</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\"><span class=\"ͼ11\"># Add labels on top of each bar showing the sum</span></div><div class=\"cm-line\"><span class=\"ͼs\">for</span> bar<span class=\"ͼ19\">,</span> sum_val <span class=\"ͼs\">in</span> <span class=\"cm-builtin\">zip</span><span class=\"ͼ19\">(</span>bars<span class=\"ͼ19\">,</span> bin_sums<span class=\"ͼ19\">)</span>:</div><div class=\"cm-line\">    plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">text</span><span class=\"ͼ19\">(</span>bar<span class=\"ͼ19\">.</span><span class=\"ͼz\">get_x</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span> <span class=\"ͼ10\">+</span> bar<span class=\"ͼ19\">.</span><span class=\"ͼz\">get_width</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ10\">/</span><span class=\"ͼu\">2</span><span class=\"ͼ19\">,</span> bar<span class=\"ͼ19\">.</span><span class=\"ͼz\">get_height</span><span class=\"ͼ19\">(</span><span class=\"ͼ19\">)</span><span class=\"ͼ19\">,</span> </div><div class=\"cm-line\">             <span class=\"ͼ13\">f'</span><span class=\"ͼ14\">{</span>sum_val:<span class=\"ͼs\">.1f</span><span class=\"ͼ14\">}</span><span class=\"ͼ13\">'</span><span class=\"ͼ19\">,</span> ha<span class=\"ͼ10\">=</span><span class=\"ͼ12\">'center'</span><span class=\"ͼ19\">,</span> va<span class=\"ͼ10\">=</span><span class=\"ͼ12\">'bottom'</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\"><br /></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">xlabel</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'X Values'</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">ylabel</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'Sum of Y Values'</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">title</span><span class=\"ͼ19\">(</span><span class=\"ͼ12\">'Histogram of Y Value Sums by X Range'</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">grid</span><span class=\"ͼ19\">(</span><span class=\"ͼ1d\">True</span><span class=\"ͼ19\">,</span> alpha<span class=\"ͼ10\">=</span><span class=\"ͼu\">0.3</span><span class=\"ͼ19\">)</span></div><div class=\"cm-line\">plt<span class=\"ͼ19\">.</span><span class=\"ͼz\">show</span><span class=\"cm-matchingBracket\"><span class=\"ͼ19\">(</span></span><span class=\"cm-matchingBracket\"><span class=\"ͼ19\">)</span></span></div></div></div></div></div>"},{"op":"replace","path":"/cells/1/inputModel/source","value":"import matplotlib.pyplot as plt\nimport numpy as np\n\nall_rems=[(k,len(processor.hash_buckets[k])) for k in processor.hash_buckets]\nimport matplotlib.pyplot as plt\n\n# Assuming allrems is a list of lists where each sublist contains [x, y]\n# Extract x and y values\nx_values = [item[0] for item in all_rems]\ny_values = [item[1] for item in all_rems]\n\n# Define the number of bins\nnum_bins = 10\n\n# Create bins based on x values\nbins = np.linspace(min(x_values), max(x_values), num_bins + 1)\n\n# Calculate sum of y values for each bin\nbin_indices = np.digitize(x_values, bins) - 1\nbin_sums = np.zeros(num_bins)\nfor i in range(len(x_values)):\n    if 0 <= bin_indices[i] < num_bins:\n        bin_sums[bin_indices[i]] += y_values[i]\n\n# Create the histogram\nplt.figure(figsize=(10, 6))\nbars = plt.bar(bins[:-1], bin_sums, width=np.diff(bins), edgecolor='black', align='edge')\n\n# Add labels on top of each bar showing the sum\nfor bar, sum_val in zip(bars, bin_sums):\n    plt.text(bar.get_x() + bar.get_width()/2, bar.get_height(), \n             f'{sum_val:.1f}', ha='center', va='bottom')\n\nplt.xlabel('X Values')\nplt.ylabel('Sum of Y Values')\nplt.title('Histogram of Y Value Sums by X Range')\nplt.grid(True, alpha=0.3)\nplt.show()"},{"op":"replace","path":"/cells/1/inputModel/id","value":"5fa3bff4-2fce-4a4c-b861-36cd7b035fab"},{"op":"replace","path":"/cells/1/id","value":"5fa3bff4-2fce-4a4c-b861-36cd7b035fab"},{"op":"replace","path":"/cells/0/outputHTML/0","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput\" data-mime-type=\"text/markdown\"><h3 id=\"hash_buckets‘s-element-distribution\" style=\"\"><span class=\"numbering-entry\"></span>hash_buckets‘s element distribution<a target=\"_self\" href=\"#hash_buckets‘s-element-distribution\" class=\"jp-InternalAnchorLink\">¶</a></h3>\n</div>"},{"op":"replace","path":"/cells/0/inputHTML","value":"<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lm-Widget jp-CodeMirrorEditor jp-Editor jp-InputArea-editor lm-mod-hidden\" data-type=\"inline\"><div class=\"cm-editor ͼ1 ͼ2 ͼ4 ͼo\" style=\"\"><div class=\"cm-announced\" aria-live=\"polite\"></div><div tabindex=\"-1\" class=\"cm-scroller\"><div spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" translate=\"no\" contenteditable=\"true\" class=\"cm-content cm-lineWrapping\" role=\"textbox\" aria-multiline=\"true\" tabindex=\"-1\" data-language=\"markdown\" style=\"tab-size: 4;\"><div class=\"cm-line\"><span class=\"ͼr ͼp\">###</span><span class=\"ͼr\"> hash_buckets‘s element distribution</span></div></div></div></div></div>"},{"op":"replace","path":"/cells/0/inputModel/source","value":"### hash_buckets‘s element distribution"},{"op":"replace","path":"/cells/0/inputModel/id","value":"1d94ebde-cc50-4465-b782-3ec662639af2"},{"op":"replace","path":"/cells/0/id","value":"1d94ebde-cc50-4465-b782-3ec662639af2"}],"checkpointRef":"9c1d4d03-62a8-41c6-a33f-a5e3b29a9e0d"},"level":3}},"root":"9c1d4d03-62a8-41c6-a33f-a5e3b29a9e0d","current":"43dbb6a4-b8c0-4741-b595-20d4a00fc1f6"}